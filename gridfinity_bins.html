<!doctype html>
<html>
  <head>
    <script src="deps/three.min.js" defer></script>
    <script src="deps/Projector.js" defer></script>
    <script src="deps/stl_viewer.min.js" defer></script>
    <script src="deps/webgl_detector.js" defer></script>
    <script src="deps/OrbitControls.js" defer></script>
    <script src="deps/parser.min.js" defer></script>
    <script src="deps/TrackballControls.js" defer></script>
    <script src="deps/CanvasRenderer.js" defer></script>
    <script src="browserfs.min.js" defer></script>
    <link rel="stylesheet" href="/css/gridfinity.css" />

    <script>
      const model_path = "gridfinity_bins/gridfinity_basic_cup.scad"; // folder name (actually zip file) and source file name

      const outstl_name = "model_out.stl";

      /**
       * @typedef {Record<string, {
       *    label: string;
       *    defaultValue: number | boolean | string;
       *    description: string;
       *    type: "text" | "number" | "checkbox" | "select";
       *    options?: string[];
       *    }
       * } ModelParams
       */
      /** @type ModelParams */
      const model_params = {
        width: {
          label: "Width (units)",
          defaultValue: 1,
          description: "Grid units left-to-right (x axis)",
          type: "number",
        },
        depth: {
          label: "Length (units)",
          defaultValue: 1,
          description: "Grid units front-to-back (y axis)",
          type: "number",
        },
        height: {
          label: "Height (units)",
          defaultValue: 6,
          description: "Multiples of 7 mm",
          type: "number",
        },
        magnet_diameter: {
          label: "Magnet hole diameter ‚åÄ (mm)",
          defaultValue: 0,
          description: "Zack's design is 6.5 mm, or 0 to omit magnet hole",
          type: "number",
        },
        screw_depth: {
          label: "Screw depth (mm)",
          defaultValue: 0,
          description: "Zack's design is 6 mm, or 0 to omit screw hole",
          type: "number",
        },
        hole_overhang_remedy: {
          label: "Hole overhang",
          defaultValue: true,
          description:
            "If both screw and magnet are defined, include feature for better printing of magnet/screw overhang",
          type: "checkbox",
        },
        chambers: {
          label: "Dividers",
          defaultValue: 1,
          description: "Subdivisions along X-axis (uniform divisions)",
          type: "number",
        },
        withLabel: {
          label: "Label and position",
          defaultValue: "disabled",
          description: "",
          type: "select",
          options: [
            "disabled",
            "left",
            "right",
            "center",
            "leftchanber",
            "rightchamber",
            "centerchamber",
          ],
        },
        fingerslide: {
          label: "Include fingerslide",
          defaultValue: true,
          description: "Large corner fillet on the front",
          type: "checkbox",
        },
        labelWidth: {
          label: "Label width (units)",
          defaultValue: 0,
          description: "In units, or 0 for full width",
          type: "number",
        },
        wall_thickness: {
          label: "Wall thickness (mm)",
          defaultValue: 0.95,
          description: "For outer walls (Zack's design is 0.95)",
          type: "number",
        },
        efficient_floor: {
          label: "Efficient floor",
          defaultValue: false,
          description:
            "Saves material and time, but the floor is not smooth (only applies if no magnets, screws, or finger-slide used)",
          type: "checkbox",
        },
        lip_style: {
          label: "Lip style",
          defaultValue: "normal",
          description: "For top of walls",
          type: "select",
          options: ["normal", "reduced", "none"],
        },
      };

      (async () => {
        if ("serviceWorker" in navigator) {
          for (const reg of await navigator.serviceWorker.getRegistrations()) {
            try {
              reg.unregister();
            } catch (e) {
              console.error(e, e.stackTrace);
            }
          }
        }
      })();
    </script>

    <script src="filesystem.js" defer></script>
    <script type="module" src="main.js" defer></script>
    <title>Gridfinity Parametric Web Generator</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üñ®Ô∏è</text></svg>"
    />
  </head>

  <body>
    <div class="root row">
      <div id="editor-panel" class="col">
        <button id="flip-mode">Flip</button>
        <form id="params"></form>
        <div>
          <br />
          <a href="" id="permalink">Link to current parameters</a>
        </div>
        <div class="logs-container">
          <pre><code id="logs"></code></pre>
        </div>
      </div>
      <div id="view-panel" class="col">
        <div class="text title desktop">
          <h1>Gridfinity Parametric Web Generator</h1>
        </div>
        <div class="text desktop">
          <a href="https://github.com/vector76/Web_OpenSCAD_Customizer"
            >Web OpenSCAD Customizer Project</a
          ><br />
          <a href="https://github.com/vector76/gridfinity_openscad"
            >Gridfinity OpenSCAD</a
          >
        </div>
        <div class="text desktop"></div>
        <div class="row text">
          <button class="button settings" id="run">Render (Ctrl+Enter)</button>
          <button class="button settings" id="kill" disabled>Kill</button>
          <div class="text-fragment" id="link-container"></div>
          <div class="text-fragment settings" id="meta"></div>
          <label class="text-fragment settings">
            <input type="checkbox" id="autorotate" />Rotate
          </label>
        </div>
        <div id="viewer" tabindex="0"></div>
        <span id="features" class="features"></span>
      </div>
    </div>
  </body>
</html>
